//Copyright timeanddate.com 2016, do not use without permission
(function e$$0(f,g,a){function b(h,e){if(!g[h]){if(!f[h]){var l="function"==typeof require&&require;if(!e&&l)return l(h,!0);if(c)return c(h,!0);l=Error("Cannot find module '"+h+"'");throw l.code="MODULE_NOT_FOUND",l;}l=g[h]={exports:{}};f[h][0].call(l.exports,function(a){var c=f[h][1][a];return b(c?c:a)},l,l.exports,e$$0,f,g,a)}return g[h].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)b(a[e]);return b})({1:[function(d,f,g){f=d(5);d(3);d(12);d(13);d(15);d(14);d(9);d(10);
ko.applyBindings(f)},{10:10,12:12,13:13,14:14,15:15,3:3,5:5,9:9}],2:[function(d,f,g){d(1)},{1:1}],3:[function(d,f,g){ko.observableArray.fn.moveTo=function(a,b){var c,e;c=this.peek();this.valueWillMutate();e=c.splice(a,1);c.splice(b,0,e[0]);this.valueHasMutated()};ko.bindingHandlers.element={init:function(a,b){b()(a)}}},{}],4:[function(d,f,g){f.exports={CLOCKS:"Clocks",COMPACT:"Compact",TABLE:"Table",SYNC_FAILED_SERVER_NOT_FOUND:"Sync Failed - Sync Server Not Found - Changes were not saved",SYNC_FAILED_UNKNOWN_ERROR:"Sync Failed - Unknown Error - Changes were not saved",
SYNC_FAILED_CONNECTION_TIMED_OUT:"Sync Failed - Connection Timed Out - Changes may not have been saved",SYNC_FAILED_INVALID_TOKEN:"Sync Failed - Invalid Token - Changes were not saved, please try refreshing the page",CITY_ADDED_ALREADY:"%s has already been added, and cannot be added twice",MAX_CITIES_REACHED:"The maximum number of cities allowed (%d) has been reached",SET_HOME_LOCATION_MODAL_TITLE:"Set Home Location",SET_TIME_FORMAT_MODAL_TITLE:"Set Time Format",BLANK:""}},{}],5:[function(d,f,g){d=
{};window.vm=d;f.exports=d},{}],6:[function(d,f,g){var a=d(10),b=d(5);f.exports=function(c){if(!c)throw Error("No CityObject");var e=this;e.id=ko.observable(c.id);e.country=ko.observable(c.co);e.flag=ko.observable(c.flag?c.flag:"blank");e.latitude=ko.observable(c.la);e.longatude=ko.observable(c.lo);e.name=ko.observable(c.name);e.link=ko.observable(c.link);e.alt=ko.observable(c.alt);e.state=ko.observable(c.state);e.abbr=ko.observable(c.abbr);e.home=ko.observable(c.home);e.visible=ko.computed(function(){return!e.home()||
e.home()&&a.options.showHomeLocation()});e.isEditing=ko.observable(!1);e.isWaitingSync=ko.observable(c.isWaitingSync);e.inputElement=ko.observable();e.isLong=ko.pureComputed(function(){var a=e.name()||"",b=e.alt()||"";return 28<a.length+b.length});e.canMoveUp=ko.pureComputed(function(){var c=b.cities.indexOf(e);return 0===c||b.cities()[0]&&b.cities()[0].home()&&!1===a.options.showHomeLocation()&&1===c?!1:!0});e.canMoveDown=ko.pureComputed(function(){var c=b.cities.indexOf(e),d=b.cities,f=b.cities().length-
1;return c===f||d()[f]&&d()[f].home()&&!1===a.options.showHomeLocation()&&c===f-1?!1:!0})}},{10:10,5:5}],7:[function(d,f,g){d=function(a){this.options=ko.observable();this.flags=ko.observable();this.siteTimeFormat=ko.observable();this.siteDateShortFormat=ko.observable();this.siteDateLongFormat=ko.observable();this.siteDefaultCity=ko.observable();this.siteHomeCityName=ko.observable();this.siteMaxCities=ko.observable();this.siteTheme=ko.observable();a&&this.setConfig(a)};d.prototype={setConfig:function(a){if(!a)throw Error("No ConfigObject");
this.options(a.wct);this.flags(a.wcc);this.siteTimeFormat(a.fti);this.siteDateShortFormat(a.fds);this.siteDateLongFormat(a.fdl);this.siteDefaultCity(a.ftz);this.siteHomeCityName(a.fhm);this.siteMaxCities(a.fmax);this.siteTheme(a.wch)},setConfigFromPWC:function(){this.setConfig(this.getPWCConfigObject())},getPWCConfigObject:function(){if("undefined"!==typeof window.PWC&&"undefined"!==typeof window.PWC.cfg)return window.PWC.cfg;throw Error("PWC Object is undefined");}};f.exports=d},{}],8:[function(d,
f,g){var a=d(5);f.exports=function(b){var c=this;c.icon=ko.observable(b.icon);c.id=b.id;c.text=b.text;c.wchId=b.wchId;c.isCurrentView=ko.computed(function(){return a.currentView()===c.id});c.setView=function(){a.setView(c.wchId)}}},{5:5}],9:[function(d,f,g){function a(a,b){"undefined"!==typeof a&&"undefined"!==typeof b&&(k.moveTo(a,b),h.sync())}function b(a){a&&(a.inputElement().blur(),a.isEditing(!1),h.sync(),document.onmousedown=null)}function c(a){if(a&&a.PWC&&a.PWC.cities){var b=ko.utils.arrayFirst(k(),
function(a){return a.isWaitingSync()});if(b){k.remove(b);var c=ko.utils.arrayFirst(a.PWC.cities,function(a){return a.id===b.id()});c&&(c=new e(c),k.push(c))}}a&&a.cks&&TO.setcks(a.cks)}var e=d(6),h=d(11),m=d(10),l=d(4),k=ko.observableArray();h.registerCitySyncFn(function(){return ko.utils.arrayMap(k(),function(a){var b={id:a.id(),alt:a.alt()};a.home()&&(b.home=1);return b})});(function(){var a=-1!==window.location.search.indexOf("cities");if("undefined"!==typeof window.PWC&&"undefined"!==typeof window.PWC.cities){var b,
c=window.PWC.cities.length;for(b=0;b<c;b++){var d=new e(window.PWC.cities[b]);k.push(d);d.home&&a&&m.options.showHomeLocation(!0)}}})();f.exports={cities:k,add:function(){if(k().length<m.config.siteMaxCities()){if(fh&&fh.addtxt&&fh.addtxt.H){var a=fh.addtxt,b=ko.utils.arrayFirst(k(),function(b){return b.id()===+a.H});b?b.home()?(m.options.showHomeLocation(!0),h.sync()):h.showError(sprintf(l.CITY_ADDED_ALREADY,b.name())):(k.push(new e({id:+a.H,name:a.T,isWaitingSync:!0})),h.sync(c))}}else h.showError(sprintf(l.MAX_CITIES_REACHED,
m.config.siteMaxCities()))},remove:function(a){a&&(1===a.home()?m.options.showHomeLocation(!1):k.remove(a),h.sync())},edit:function(a){a&&(a.isEditing(!0),a.inputElement().focus(),document.onmousedown=function(c){c||(c=window.event);(c.target||c.srcElement)!==a.inputElement()&&b(a)})},rename:b,move:a,moveRelative:function(b,c){var d=k().indexOf(b),e=d+c;0<=e&&e<k().length&&a(d,e)},sort:function(a){k.sort(function(b,c){if("timezone"===a){var d=TO.city(b.id()),e=TO.city(c.id());b=d.o;c=e.o}else b=b[a](),
c=c[a]();return b<c?-1:b>c?1:0});h.sync()},sortReverse:function(){k.reverse();h.sync()}}},{10:10,11:11,4:4,6:6}],10:[function(d,f,g){g=d(7);var a=d(11),b=new g,c={},e={},h="showDigitalClock showAnalog showFullDates showAbbreviationName showDstStar showSeconds showHomeLocation hideCountryFlag showDayNight".split(" "),m=function(a){for(var b in c)if(c.hasOwnProperty(b))c[b](!!(a&e[b]))},l=function(){},k=function(){};(function(){for(var a=0;a<h.length;a++)c[h[a]]=ko.observable(!1),e[h[a]]=Math.pow(2,
a)})();b.options.subscribe(function(a){m(a)});b.setConfigFromPWC();a.registerConfigSyncFn(function(){for(var a=0,d=0;d<h.length;d++)c[h[d]]()&&(a+=Math.pow(2,d));return{wct:a,wch:b.siteTheme()}});-1!==window.location.search.indexOf("cities")&&c.showHomeLocation(!1);f.exports={options:c,config:b,save:function(){a.sync(l,k)},applyOptions:m}},{11:11,7:7}],11:[function(d,f,g){function a(a){clearTimeout(r);h(!1);m(!0);l(a);r=setTimeout(b,4E3)}function b(){m(!1);l("")}function c(b,c,d,f,k){h(!0);f=f||function(){};
k=k||function(){};var g=gx(),l="",n;for(n in d)l+=n+"="+encodeURIComponent(JSON.stringify(d[n]))+"&";g.onreadystatechange=function(){if(4===g.readyState)if(200===g.status){h(!1);m(!1);var b=ko.utils.parseJson(g.responseText);f(b)}else 400===g.status?"ERR:Invalid token"===g.responseText?a(e.SYNC_FAILED_INVALID_TOKEN):a(e.SYNC_FAILED_UNKNOWN_ERROR):404===g.status?a(e.SYNC_FAILED_SERVER_NOT_FOUND):a(e.SYNC_FAILED_UNKNOWN_ERROR),k()};g.ontimeout=function(){a(e.SYNC_FAILED_SERVER_NOT_FOUND);k()};g.open(c,
document.location.protocol+"//"+document.domain+(document.location.port?":"+document.location.port:"")+b,!0);g.timeout=8E3;g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.send("data="+encodeURIComponent(JSON.stringify(d)))}var e=d(4),h=ko.observable(!1),m=ko.observable(!1),l=ko.observable(""),k=-1!==window.location.search.indexOf("cities"),p=function(){},q=function(){},r=null;f.exports={sync:function(a,b){var d=p();var e=q();k||(h(!0),d={cities:d,cfg:e},PWC.ft&&(d.ft=PWC.ft),
c("/scripts/savepersonaljson.php","POST",d,a,b))},isUpdating:h,showError:a,hasError:m,errorMessage:l,registerCitySyncFn:function(a){p=a},registerConfigSyncFn:function(a){q=a}}},{4:4}],12:[function(d,f,g){function a(a,b,c){for(var d=0;d<e.length;d++)e[d]||(b=b.toLowerCase()),ael(a,e[d]+b,c,!1)}var b=d(5),c=d(9);b.cities=c.cities;b.citySearchValue=ko.observable("");b.citySearchInput=ko.observable();b.moveCity=function(a,b){c.move(a,b)};b.moveCityUp=function(){c.moveRelative(this,-1)};b.moveCityDown=
function(){c.moveRelative(this,1)};b.addCity=function(){c.add();b.isAddingCity(!1)};b.removeCity=function(){c.remove(this)};b.editCity=function(){c.edit(this)};b.renameCity=function(){c.rename(this)};b.showAddCityModal=function(){b.isAddingCity(!0);b.citySearchInput().value="";b.citySearchValue("");b.citySearchInput().focus()};b.cancelAddCityModal=function(){b.isAddingCity(!1)};b.toggleEdit=function(){b.isEditing(!b.isEditing())};b.getLongNameCss=function(a){return 28<a.length?"c-city__title--long":
""};b.sortByCity=function(){c.sort("name")};b.sortByCountry=function(){c.sort("country")};b.sortByTimeZone=function(){c.sort("timezone")};b.sortReverse=function(){c.sortReverse()};b.isEditing=ko.observable(!1);b.isAddingCity=ko.observable(!1);var e=["webkit","moz","MS","o",""];b.fadeIn=function(b){b=b[1];ac(b,"is-just-added",1);a(b,"AnimationEnd",function(){ac(this,"is-just-added",0)})}},{5:5,9:9}],13:[function(d,f,g){var a=d(5);f=d(10);var b=d(4);a.config=f;a.showConfigModal=function(){a.isEditingConfig(!0)};
a.closeConfigModal=function(){a.isEditingConfig(!1);a.config.save()};a.setHomeLocation=function(){a.closeConfigModal();modpop("/scripts/tzq.php?type=homecity",1,b.SET_HOME_LOCATION_MODAL_TITLE)};a.setTimeFormat=function(){a.closeConfigModal();modpop("/scripts/tzq.php?type=time",1,b.SET_TIME_FORMAT_MODAL_TITLE)};a.isEditingConfig=ko.observable(!1)},{10:10,4:4,5:5}],14:[function(d,f,g){var a=d(5),b=d(9),c=d(10);d=-1!==window.location.search.indexOf("cities");a.isSharing=ko.observable(!1);a.shareLink=
ko.pureComputed(function(){var a=ko.utils.arrayFilter(b.cities(),function(a){return a.home()&&!c.options.showHomeLocation()?!1:!0}),a=ko.utils.arrayMap(a,function(a){return a.id()}),a=window.location.origin+window.location.pathname+"?cities="+a.join(",");1<c.config.siteTheme()&&(a+="&wch="+c.config.siteTheme());return a});a.closeShareModal=function(){a.isSharing(!1)};a.isShared=ko.observable(d)},{10:10,5:5,9:9}],15:[function(d,f,g){var a=d(5),b=d(11);f=d(8);var c=d(10);d=d(4);var e={1:"clocks",2:"compact",
3:"table"};a.currentView=ko.pureComputed(function(){var a=c.config.siteTheme();return e[a]});a.availableViews=ko.observableArray([new f({icon:"&#xe1ff;",id:"clocks",text:d.CLOCKS,wchId:1}),new f({icon:"&#xe300;",id:"compact",text:d.COMPACT,wchId:2}),new f({icon:"&#xe20e;",id:"table",text:d.TABLE,wchId:3})]);a.isView=function(b){return b===a.currentView()};a.setView=function(a){c.config.siteTheme(a);TO.setcks(cks);b.sync()};a.isFullscreen=ko.observable(!1);a.toggleFullscreen=function(){a.isFullscreen(!a.isFullscreen())};
a.isUpdating=b.isUpdating;a.hasError=b.hasError;a.errorMessage=b.errorMessage;a.hasError.subscribe(function(b){b&&setTimeout(function(){anpop(a.errorMessage(),"error alert--error",4E3)},1)});a.hasFixedTime=window.TAD&&window.TAD.timedesc;a.fixedTimeMsg=window.TAD&&window.TAD.msg?window.TAD.msg:"";a.fixedTimeDesc=window.TAD&&window.TAD.timedesc?window.TAD.timedesc:"";a.fixedTimeModUrl=window.TAD&&window.TAD.modifyurl?window.TAD.modifyurl:""},{10:10,11:11,4:4,5:5,8:8}]},{},[2]);
